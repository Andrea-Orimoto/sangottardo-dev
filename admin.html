<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin – Inventario San Gottardo</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="style.css?9" rel="stylesheet">

  <!-- Google Sign-In (same as index.html) -->
  <meta name="google-signin-client_id" content="1049409960184-lt0jqecoman6nmnfgc94ntss04vemur2.apps.googleusercontent.com">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">

  <div class="container mx-auto p-6 max-w-5xl">

    <!-- Header -->
    <header class="flex justify-between items-center mb-10 pb-6 border-b">
      <div class="flex items-center gap-6">
        <a href="index.html" class="text-indigo-600 hover:text-indigo-800 font-medium">
          ← Torna alla home
        </a>
        <h1 class="text-3xl font-bold">Admin Page</h1>
      </div>

      <div class="flex items-center gap-4">
        <div id="userInfo" class="hidden flex items-center gap-3">
          <img id="userPhoto" class="w-10 h-10 rounded-full border-2 border-indigo-600" src="" alt="">
          <span id="userName" class="font-medium"></span>
        </div>
        <button id="logoutBtn" class="hidden bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded transition">
          Logout
        </button>
      </div>
    </header>

    <!-- Main Content (empty for now – we’ll fill it later) -->
    <div class="bg-white rounded-lg shadow p-8 text-center text-gray-600">
      <p class="text-xl">Benvenuto nella sezione Admin</p>
      <p class="mt-4">Questa pagina è visibile solo agli amministratori.</p>
      <p class="mt-8 text-5xl">Under Construction</p>
    </div>

  </div>

  <!-- Google Login + Admin Check Script -->
  <script>
    const ADMIN_EMAIL = 'andrea.orimoto@gmail.com';
    window.currentUser = null;

    // Restore session from localStorage
    const saved = localStorage.getItem('sgUser');
    if (saved) window.currentUser = JSON.parse(saved);

    function isAdmin() {
      return window.currentUser && window.currentUser.email === ADMIN_EMAIL;
    }

    function redirectIfNotAdmin() {
      if (!isAdmin()) {
        alert('Accesso negato. Solo gli amministratori possono vedere questa pagina.');
        window.location.href = 'index.html';
      }
    }

    function updateAuthUI() {
      const userInfo = document.getElementById('userInfo');
      const userPhoto = document.getElementById('userPhoto');
      const userName = document.getElementById('userName');
      const logoutBtn = document.getElementById('logoutBtn');

      if (window.currentUser) {
        userName.textContent = window.currentUser.name.split(' ')[0];
        userPhoto.src = window.currentUser.picture;
        userInfo.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');
      }
    }

    function logout() {
      window.currentUser = null;
      localStorage.removeItem('sgUser');
      google.accounts.id.disableAutoSelect();
      window.location.href = 'index.html';  // redirect to home after logout
    }

    // Initialize Google (needed even if already logged in)
    window.onload = function () {
      google.accounts.id.initialize({
        client_id: '1049409960184-lt0jqecoman6nmnfgc94ntss04vemur2.apps.googleusercontent.com',
        callback: () => location.reload()   // simple reload on new login
      });

      // If user is not logged in → send to home
      if (!window.currentUser) {
        window.location.href = 'index.html';
      } else {
        updateAuthUI();
        redirectIfNotAdmin();   // this is the protection
      }

      document.getElementById('logoutBtn').addEventListener('click', logout);
    };
  </script>
</body>
</html>